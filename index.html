<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Remi Score Tracker</title>
<style>
    body {
        font-family: Arial, sans-serif;
        background: #f0f0f0;
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 20px;
    }
    h1 { color: #333; }
    input, button { padding: 10px; margin: 5px; border-radius: 5px; border: 1px solid #ccc; }
    button { background-color: #007bff; color: white; border: none; cursor: pointer; }
    button:hover { background-color: #0056b3; }
    .player { margin: 5px 0; }
    .results, .history { margin-top: 20px; width: 100%; max-width: 400px; }
    .results div, .history div { display: flex; justify-content: space-between; padding: 5px; background: white; margin-bottom: 5px; border-radius: 5px; }
    .history-title { margin-top: 30px; font-weight: bold; }
</style>
</head>
<body>

<h1>Remi Score Tracker</h1>

<div id="setup">
    <input type="number" id="numPlayers" placeholder="Broj igrača (2-6)" min="2" max="6">
    <button onclick="setupPlayers()">Dalje</button>
</div>

<div id="game" style="display:none;">
    <div id="playersList"></div>
    <button onclick="addRound()">Dodaj bodove za rundu</button>
    <button onclick="finishGame()">Završi igru</button>

    <div class="results" id="results"></div>
    
    <div class="history-title">Istorija rundi:</div>
    <div class="history" id="history"></div>
</div>

<script>
const state = { players: [], scores: [], dealerIndex: 0, rounds: [] };

// Učitavanje iz localStorage ako postoji
if (localStorage.getItem('remiState')) {
    const saved = JSON.parse(localStorage.getItem('remiState'));
    Object.assign(state, saved);
    if(state.players.length > 0) {
        document.getElementById('setup').style.display = 'none';
        document.getElementById('game').style.display = 'block';
        renderPlayers();
        renderResults();
        renderHistory();
    }
}

function setupPlayers() {
    const num = parseInt(document.getElementById("numPlayers").value);
    if (isNaN(num) || num < 2 || num > 6) return alert("Unesi broj između 2 i 6.");
    state.players = [];
    state.scores = [];
    state.rounds = [];
    state.dealerIndex = 0;
    for (let i = 0; i < num; i++) {
        const name = prompt(`Unesi ime igrača ${i+1}:`);
        state.players.push(name || `Igrač ${i+1}`);
        state.scores.push(0);
    }
    saveState();
    document.getElementById('setup').style.display = 'none';
    document.getElementById('game').style.display = 'block';
    renderPlayers();
    renderResults();
    renderHistory();
}

function renderPlayers() {
    const listDiv = document.getElementById('playersList');
    listDiv.innerHTML = '';
    state.players.forEach((p, i) => {
        const div = document.createElement('div');
        div.className = 'player';
        div.innerHTML = `<strong>${p}</strong> (Dealer: ${i === state.dealerIndex ? '✔' : ''}) <input type="number" placeholder="Bodovi" id="score${i}">`;
        listDiv.appendChild(div);
    });
}

function addRound() {
    const roundScores = [];
    state.players.forEach((p, i) => {
        const val = parseInt(document.getElementById(`score${i}`).value);
        const points = !isNaN(val) ? val : 0;
        state.scores[i] += points;
        roundScores.push(points);
        document.getElementById(`score${i}`).value = '';
    });
    state.rounds.push(roundScores);
    state.dealerIndex = (state.dealerIndex + 1) % state.players.length;
    saveState();
    renderPlayers();
    renderResults();
    renderHistory();
}

function renderResults() {
    const resDiv = document.getElementById('results');
    resDiv.innerHTML = '';
    const sorted = state.players.map((p,i)=>({name:p,score:state.scores[i]}))
        .sort((a,b)=>a.score-b.score);
    sorted.forEach(s => {
        const div = document.createElement('div');
        div.innerHTML = `<span>${s.name}</span><span>${s.score}</span>`;
        resDiv.appendChild(div);
    });
}

function renderHistory() {
    const histDiv = document.getElementById('history');
    histDiv.innerHTML = '';
    state.rounds.forEach((round, idx) => {
        const div = document.createElement('div');
        div.innerHTML = `<span>Runda ${idx+1}</span><span>${round.map((s,i)=>state.players[i]+':'+s).join(', ')}</span>`;
        histDiv.appendChild(div);
    });
}

function finishGame() {
    if(confirm("Da li želiš završiti igru? Svi rezultati će biti izbrisani.")) {
        localStorage.removeItem('remiState');
        state.players = [];
        state.scores = [];
        state.dealerIndex = 0;
        state.rounds = [];
        document.getElementById('setup').style.display = 'block';
        document.getElementById('game').style.display = 'none';
    }
}

function saveState() {
    localStorage.setItem('remiState', JSON.stringify(state));
}
</script>

</body>
</html>
